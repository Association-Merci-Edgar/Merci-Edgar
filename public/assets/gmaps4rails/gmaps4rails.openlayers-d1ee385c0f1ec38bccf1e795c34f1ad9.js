!function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};this.Gmaps4RailsOpenlayers=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.map_options={},this.mergeWithDefault("map_options"),this.markers_conf={},this.mergeWithDefault("markers_conf"),this.openMarkers=null,this.markersLayer=null,this.markersControl=null,this.polylinesLayer=null}return t(r,e),r.prototype.createPoint=function(){},r.prototype.createLatLng=function(e,t){return new OpenLayers.LonLat(t,e).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))},r.prototype.createAnchor=function(e){return null===e?null:new OpenLayers.Pixel(e[0],e[1])},r.prototype.createSize=function(e,t){return new OpenLayers.Size(e,t)},r.prototype.createLatLngBounds=function(){return new OpenLayers.Bounds},r.prototype.createMap=function(){var e;return e=new OpenLayers.Map(this.map_options.id),e.addLayer(new OpenLayers.Layer.OSM),e.setCenter(this.createLatLng(this.map_options.center_latitude,this.map_options.center_longitude),this.map_options.zoom),e},r.prototype.createMarker=function(e){var t,r;return r=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),r.fillOpacity=1,null===this.markersLayer&&(this.markersLayer=new OpenLayers.Layer.Vector("Markers",null),this.serviceObject.addLayer(this.markersLayer),this.markersLayer.events.register("featureselected",this.markersLayer,this.onFeatureSelect),this.markersLayer.events.register("featureunselected",this.markersLayer,this.onFeatureUnselect),this.markersControl=new OpenLayers.Control.SelectFeature(this.markersLayer),this.serviceObject.addControl(this.markersControl),this.markersControl.activate()),""===e.marker_picture?(r.graphicHeight=30,r.externalGraphic="http://openlayers.org/dev/img/marker-blue.png"):(r.graphicWidth=e.marker_width,r.graphicHeight=e.marker_height,r.externalGraphic=e.marker_picture,null!==e.marker_anchor&&(r.graphicXOffset=e.marker_anchor[0],r.graphicYOffset=e.marker_anchor[1]),""!==e.shadow_picture&&(r.backgroundGraphic=e.shadow_picture,r.backgroundWidth=e.shadow_width,r.backgroundHeight=e.shadow_height,null!==e.shadow_anchor&&(r.backgroundXOffset=e.shadow_anchor[0],r.backgroundYOffset=e.shadow_anchor[1]))),r.graphicTitle=e.marker_title,t=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.Lng,e.Lat),null,r),t.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.markersLayer.addFeatures([t]),t},r.prototype.clearMarkers=function(){return this.clearMarkersLayerIfExists(),this.markersLayer=null,this.boundsObject=new OpenLayers.Bounds},r.prototype.clearMarkersLayerIfExists=function(){return null!==this.markersLayer&&null!==this.serviceObject.getLayer(this.markersLayer.id)?this.serviceObject.removeLayer(this.markersLayer):void 0},r.prototype.extendBoundsWithMarkers=function(){var e,t,r,n,o;for(console.log("here"),n=this.markers,o=[],t=0,r=n.length;r>t;t++)e=n[t],o.push(this.boundsObject.extend(this.createLatLng(e.lat,e.lng)));return o},r.prototype.createClusterer=function(e){var t,r,n,o,s;return n={pointRadius:"${radius}",fillColor:"#ffcc66",fillOpacity:.8,strokeColor:"#cc6633",strokeWidth:"${width}",strokeOpacity:.8},r={context:{width:function(e){var t;return null!=(t=e.cluster)?t:{2:1}},radius:function(e){var t;return t=2,e.cluster&&(t=Math.min(e.attributes.count,7)+2),t}}},s=new OpenLayers.Style(n,r),o=new OpenLayers.Strategy.Cluster,t=new OpenLayers.Layer.Vector("Clusters",{strategies:[o],styleMap:new OpenLayers.StyleMap({"default":s,select:{fillColor:"#8aeeef",strokeColor:"#32a8a9"}})}),this.clearMarkersLayerIfExists(),this.serviceObject.addLayer(t),t.addFeatures(e),t},r.prototype.clusterize=function(){var e,t,r,n,o;if(this.markers_conf.do_clustering===!0){for(null!==this.markerClusterer&&this.clearClusterer(),t=new Array,o=this.markers,r=0,n=o.length;n>r;r++)e=o[r],t.push(e.serviceObject);return this.markerClusterer=this.createClusterer(t)}},r.prototype.clearClusterer=function(){return this.serviceObject.removeLayer(this.markerClusterer)},r.prototype.createInfoWindow=function(e){return null!=e.description?e.serviceObject.infoWindow=e.description:void 0},r.prototype.onPopupClose=function(){return this.markersControl.unselect(this.feature)},r.prototype.onFeatureSelect=function(e){var t,r;return t=e.feature,r=new OpenLayers.Popup.FramedCloud("featurePopup",t.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(300,200),t.infoWindow,null,!0,this.onPopupClose),t.popup=r,r.feature=t,this.map.addPopup(r)},r.prototype.onFeatureUnselect=function(e){var t;return t=e.feature,t.popup?(this.map.removePopup(t.popup),t.popup.destroy(),t.popup=null):void 0},r.prototype.create_polyline=function(e){var t,r,n,o,s,a,i,p,l,u,c,y;for(null===this.polylinesLayer&&(this.polylinesLayer=new OpenLayers.Layer.Vector("Polylines",null),this.serviceObject.addLayer(this.polylinesLayer),this.polylinesLayer.events.register("featureselected",this.polylinesLayer,this.onFeatureSelect),this.polylinesLayer.events.register("featureunselected",this.polylinesLayer,this.onFeatureUnselect),this.polylinesControl=new OpenLayers.Control.DrawFeature(this.polylinesLayer,OpenLayers.Handler.Path),this.serviceObject.addControl(this.polylinesControl)),a=[],c=0,y=e.length;y>c;c++)r=e[c],r===e[0]&&(i=r.strokeColor||this.polylines_conf.strokeColor,p=r.strokeOpacity||this.polylines_conf.strokeOpacity,l=r.strokeWeight||this.polylines_conf.strokeWeight,t=r.clickable||this.polylines_conf.clickable,u=r.zIndex||this.polylines_conf.zIndex),null!=r.lat&&null!=r.lng&&(n=new OpenLayers.Geometry.Point(r.lng,r.lat),a.push(n));return o=new OpenLayers.Geometry.LineString(a),s={strokeColor:i,strokeOpacity:p,strokeWidth:l},e=new OpenLayers.Feature.Vector(o,null,s),e.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.polylinesLayer.addFeatures([e]),e},r.prototype.updateBoundsWithPolylines=function(){},r.prototype.updateBoundsWithPolygons=function(){},r.prototype.updateBoundsWithCircles=function(){},r.prototype.fitBounds=function(){return this.serviceObject.zoomToExtent(this.boundsObject,!0)},r.prototype.centerMapOnUser=function(){return this.serviceObject.setCenter(this.userLocation)},r.prototype.extendMapBounds=function(){},r.prototype.adaptMapToBounds=function(){return this.fitBounds()},r}(Gmaps4Rails)}.call(this);