!function(e){var n=0;e(document).on("click",".add_fields",function(t){t.preventDefault();var o=e(this),i=o.data("association"),r=o.data("associations"),s=o.data("association-insertion-template"),a=o.data("association-insertion-method")||o.data("association-insertion-position")||"before";insertionNode=o.data("association-insertion-node"),insertionTraversal=o.data("association-insertion-traversal"),regexp_braced=new RegExp("\\[new_"+i+"\\](.*?\\s)","g"),regexp_underscord=new RegExp("_new_"+i+"_(\\w*)","g"),new_id=(new Date).getTime()+n++,newcontent_braced="["+new_id+"]",newcontent_underscord="_"+new_id+"_",new_content=s.replace(regexp_braced,"["+new_id+"]$1"),new_content==s&&(regexp_braced=new RegExp("\\[new_"+r+"\\](.*?\\s)","g"),regexp_underscord=new RegExp("_new_"+r+"_(\\w*)","g"),new_content=s.replace(regexp_braced,"["+new_id+"]$1")),new_content=new_content.replace(regexp_underscord,newcontent_underscord+"$1"),insertionNode=insertionNode?insertionTraversal?o[insertionTraversal](insertionNode):"this"==insertionNode?o:e(insertionNode):o.parent();var d=e(new_content);insertionNode.trigger("cocoon:before-insert",[d]),insertionNode[a](d),insertionNode.trigger("cocoon:after-insert",[d])}),e(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(n){var t=e(this),o=t.closest(".nested-fields"),i=o.parent();n.preventDefault(),i.trigger("cocoon:before-remove",[o]);var r=i.data("remove-timeout")||0;setTimeout(function(){t.hasClass("dynamic")?t.closest(".nested-fields").remove():(t.prev("input[type=hidden]").val("1"),t.closest(".nested-fields").hide()),i.trigger("cocoon:after-remove",[o])},r)})}(jQuery);